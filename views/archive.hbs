{{!-- views/archive.hbs --}}

<div class="orders-page-container">
  <div class="header-section">
    <h1 class="page-title">Архив заказов</h1>

    <div class="filter-wrapper">
      <div class="filter-section">
        <div class="filter-item active"><span>Все полученные заказы</span></div>
        <div class="filter-item"><span>За последний месяц</span></div>
        <div class="filter-item"><span>За последний год</span></div>
      </div>

      <div class="search-container input-field">
        <input id="search" type="text" placeholder="Поиск по архиву заказов...">
      </div>
    </div>
  </div>

  <div class="divider"></div>

  <div class="orders-container card-panel white lighten-1">
    <table class="highlight responsive-table">
      <thead>
        <tr>
          <th>ID Заказа</th>
          <th>Дата доставки</th>
          <th>Пользователь</th>
          <th>Сумма</th>
          <th>Товары</th>
          <th>Статус</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="archive-body">
        {{#each archive}}
          <tr>
            <form method="POST" action="/archive/update/{{this.id}}">
              <td>{{id}}</td>
              <td>{{delivery_date}}</td>
              <td>{{user}}</td>
              <td>{{total}} ₽</td>
              <td>
                {{#each items}}
                  <a href="{{this.link}}" class="product-link" target="_blank">{{this.name}}</a>{{#unless @last}}, {{/unless}}
                {{/each}}
              </td>
              <td>
                <select name="status" class="browser-default">
                  <option value="На рассмотрении" {{#if (isEqual this.status "На рассмотрении")}}selected{{/if}}>На рассмотрении</option>
                  <option value="Закупаем" {{#if (isEqual this.status "Закупаем")}}selected{{/if}}>Закупаем</option>
                  <option value="Ждём поставку" {{#if (isEqual this.status "Ждём поставку")}}selected{{/if}}>Ждём поставку</option>
                  <option value="Готово к получению" {{#if (isEqual this.status "Готово к получению")}}selected{{/if}}>Готово к получению</option>
                  <option value="Получен" {{#if (isEqual this.status "Получен")}}selected{{/if}}>Получен</option>
                </select>
              </td>
              <td>
                <button type="submit" class="btn-flat tooltipped" data-tooltip="Сохранить изменения">
                  <i class="material-icons green-text">check</i>
                </button>
              </td>
            </form>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    M.AutoInit();

    document.querySelectorAll('.filter-item').forEach(item => {
      item.addEventListener('click', function () {
        document.querySelectorAll('.filter-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
      });
    });

    // Поиск
    const searchInput = document.getElementById('search');
    const rows = Array.from(document.querySelectorAll('#archive-body tr'));

    searchInput.addEventListener('input', function () {
      const query = this.value.toLowerCase();
      rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(query) ? '' : 'none';
      });
    });
  });
</script>